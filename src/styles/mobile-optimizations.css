/* Mobile Optimizations - Consolidated & Optimized */

@media (max-width: 768px) {
  /* === GLOBAL MOBILE SAFETY === */
  
  /* Prevent horizontal scroll globally */
  body, html {
    overflow-x: hidden !important;
    max-width: 100vw !important;
    box-sizing: border-box !important;
  }

  /* Global responsive images */
  img {
    max-width: 100% !important;
    height: auto !important;
  }

  /* === TEXT OPTIMIZATION === */
  
  /* Text wrapping and readability */
  .mobile-text-wrap, .mobile-text-wrap * {
    word-wrap: break-word !important;
    word-break: break-word !important;
    hyphens: auto !important;
    overflow-wrap: break-word !important;
  }

  /* Minimum font sizes for readability - using design tokens */
  p, span, div, li, td, th {
    font-size: var(--font-size-sm) !important;
    line-height: var(--line-height-normal) !important;
  }

  .text-xs, .text-sm {
    font-size: var(--font-size-sm) !important;
  }

  /* === LAYOUT OPTIMIZATION === */
  
  /* Single column grids */
  .mobile-grid-1 .grid,
  .mobile-grid-1.grid {
    grid-template-columns: 1fr !important;
    gap: var(--spacing-4) !important;
  }

  /* Safe containers - reduced padding to fix 16px overflow */
  .mobile-container-safe {
    width: 100%;
    max-width: 100vw;
    padding-left: var(--spacing-3);
    padding-right: var(--spacing-3);
    margin: 0 auto;
    box-sizing: border-box;
  }

  /* Card containers */
  .mobile-card-safe {
    width: 100% !important;
    max-width: calc(100vw - var(--spacing-8)) !important;
    margin: 0 auto !important;
    box-sizing: border-box !important;
  }

  /* === INTERACTIVE ELEMENTS === */

  /* Enhanced Touch targets with proper sizing */
  .mobile-touch-optimize,
  .mobile-touch-optimize button:not(.btn-design-system),
  .mobile-touch-optimize .btn:not(.btn-design-system),
  [role="button"].mobile-touch-target,
  .touch-target {
    min-height: var(--touch-target-min, 56px);
    min-width: var(--touch-target-min, 56px);
    touch-action: manipulation; /* Improves touch responsiveness */
    -webkit-tap-highlight-color: transparent; /* Remove iOS tap highlight */
  }

  /* Legacy touch targets - enhanced for better usability */
  button:not([class*="btn-"]):not([class*="Button"]),
  [role="button"]:not([class*="btn-"]) {
    min-height: 56px;
    min-width: 56px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  /* Specific touch targets for different element types */
  .touch-target-small {
    min-height: 48px !important;
    min-width: 48px !important;
    touch-action: manipulation !important;
  }

  .touch-target-medium {
    min-height: 56px !important;
    min-width: 56px !important;
    touch-action: manipulation !important;
  }

  .touch-target-large {
    min-height: 64px !important;
    min-width: 64px !important;
    touch-action: manipulation !important;
  }

  /* Enhanced gesture support */
  .gesture-enabled {
    touch-action: pan-x pan-y; /* Allow panning in both directions */
    user-select: none; /* Prevent text selection during gestures */
    -webkit-user-select: none;
  }

  /* Swipe-enabled elements */
  .swipe-enabled {
    touch-action: pan-y; /* Allow vertical scrolling but enable horizontal swipes */
    cursor: grab;
    user-select: none;
    -webkit-user-select: none;
  }

  .swipe-enabled:active {
    cursor: grabbing;
  }

  /* Pull-to-refresh support */
  .pull-to-refresh-enabled {
    touch-action: pan-x pan-down; /* Enable pull down gesture */
    overscroll-behavior-y: contain; /* Prevent rubber band effect */
  }

  /* Navigation links and menu items */
  nav a, .nav-link, [role="menuitem"] {
    min-height: 48px !important;
    display: flex !important;
    align-items: center !important;
    padding: var(--spacing-3) var(--spacing-4) !important;
  }

  /* Input elements - enhanced for better touch */
  /* Base touch sizing; use .mobile-form-full for full-width controls */
  input, select, textarea, .input {
    min-height: 56px !important; /* Increased for better touch */
    padding: var(--spacing-3) var(--spacing-4) !important;
    font-size: 16px !important; /* Prevent iOS zoom */
    box-sizing: border-box !important;
    border-radius: var(--radius-md) !important;
    touch-action: manipulation !important;
    -webkit-tap-highlight-color: transparent !important;
  }

  /* Checkbox and radio buttons - larger click area */
  input[type="checkbox"], input[type="radio"] {
    min-width: 20px !important;
    min-height: 20px !important;
    margin: var(--spacing-2) !important;
  }

  /* Label click area for checkboxes/radios */
  label:has(input[type="checkbox"]), 
  label:has(input[type="radio"]) {
    min-height: 44px !important;
    display: flex !important;
    align-items: center !important;
    padding: var(--spacing-2) !important;
    cursor: pointer !important;
  }

  /* Mobile buttons - enhanced (opt-in only) */
  .mobile-button-full,
  .mobile-button-full button,
  .mobile-button-full .btn {
    width: 100%;
    min-height: 56px; /* Increased for better touch */
    white-space: normal;
    word-wrap: break-word;
    text-align: center;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  /* Smart mobile button wrapper - only applies styling when explicitly requested */
  .mobile-button-wrapper {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-2);
  }

  .mobile-button-wrapper button,
  .mobile-button-wrapper .btn {
    width: 100%;
    min-height: 48px;
  }

  /* Icon buttons - smart touch targets (less aggressive) */
  .mobile-icon-button,
  button[class*="icon"]:not(.btn-design-system),
  .btn-icon:not(.btn-design-system) {
    min-width: 44px;
    min-height: 44px;
  }

  /* Legacy icon buttons fallback */
  button:has(svg):not(:has(span)):not([class*="btn-"]):not([class*="Button"]) {
    min-width: 44px;
    min-height: 44px;
    padding: var(--spacing-2);
  }

  /* Dropdown and select triggers */
  .select-trigger, [role="combobox"] {
    min-height: 48px !important;
    padding: var(--spacing-2) var(--spacing-4) !important;
  }

  /* Tab navigation */
  [role="tab"], .tab-trigger {
    min-height: 44px !important;
    min-width: 44px !important;
    padding: var(--spacing-2) var(--spacing-4) !important;
  }

  /* Cards and interactive areas */
  .card:hover, .card[role="button"], a .card {
    min-height: 64px !important;
    padding: var(--spacing-4) !important;
  }

  /* === TOUCH TARGET SPACING === */

  /* Prevent cramped layouts - opt-in spacing for touch targets */
  .mobile-touch-spacing button + button,
  .mobile-touch-spacing .btn + .btn,
  .mobile-touch-spacing a + a {
    margin-left: var(--spacing-2);
    margin-top: var(--spacing-2);
  }

  /* Smart button group spacing */
  .mobile-button-group {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-2);
  }

  .mobile-button-group--horizontal {
    flex-direction: row;
    flex-wrap: wrap;
  }

  /* Form element spacing */
  form .space-y-4 > * + * {
    margin-top: var(--spacing-4) !important;
  }

  form .space-y-6 > * + * {
    margin-top: var(--spacing-6) !important;
  }

  /* Button group spacing - less aggressive */
  .mobile-button-group-legacy {
    gap: var(--spacing-2);
  }

  .mobile-button-group-legacy button,
  .mobile-button-group-legacy .btn {
    min-width: calc(50% - var(--spacing-1));
  }

  /* Modern button group (preferred) */
  .button-group-mobile {
    display: flex;
    gap: var(--spacing-2);
    flex-wrap: wrap;
  }

  .button-group-mobile > * {
    flex: 1;
    min-width: 120px;
  }

  /* Navigation spacing */
  nav ul li + li {
    margin-top: var(--spacing-1) !important;
  }

  /* List item spacing for touch */
  ul li, ol li {
    min-height: 32px !important;
    padding: var(--spacing-1) 0 !important;
  }

  /* Interactive list items */
  ul li a, ol li a, .list-item[role="button"] {
    min-height: 44px !important;
    padding: var(--spacing-2) var(--spacing-3) !important;
    display: block !important;
  }

  /* === Z-INDEX & OVERLAYS === */
  
  /* Hero text overlays */
  .mobile-hero-container {
    position: relative !important;
    z-index: 45 !important;
  }

  .mobile-hero-container * {
    position: relative !important;
    z-index: 50 !important;
  }

  .mobile-text-overlay {
    position: relative !important;
    z-index: 30 !important;
  }

  /* === TEXT SHADOWS === */
  
  /* Standard text shadows */
  .mobile-text-shadow {
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7), 0 0 8px rgba(0, 0, 0, 0.3) !important;
  }

  /* Hero text shadows */
  .mobile-hero-text {
    text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.9), 0 0 12px rgba(0, 0, 0, 0.7), 0 0 20px rgba(0, 0, 0, 0.5) !important;
    position: relative !important;
    z-index: 50 !important;
  }

  /* === UTILITY CLASSES === */
  
  /* Prevent horizontal scroll utility */
  .no-horizontal-scroll {
    overflow-x: hidden !important;
    max-width: 100vw !important;
  }

  /* Additional overflow prevention for containers */
  .container {
    max-width: 100vw !important;
    padding-left: var(--spacing-3) !important;
    padding-right: var(--spacing-3) !important;
  }

  /* Responsive media container */
  .responsive-media img,
  .responsive-media video,
  .responsive-media iframe,
  .responsive-media svg,
  .responsive-media canvas {
    max-width: 100% !important;
    height: auto !important;
    object-fit: contain !important;
  }

  /* Flex wrapping */
  .mobile-flex-wrap .flex {
    flex-wrap: wrap !important;
  }

  .mobile-flex-safe .flex > * {
    min-width: 0 !important;
    flex-shrink: 1 !important;
  }

  /* === PERFORMANCE OPTIMIZATIONS === */
  
  /* GPU acceleration for smooth scrolling */
  .mobile-smooth-scroll {
    -webkit-overflow-scrolling: touch !important;
    scroll-behavior: smooth !important;
  }

  /* Optimized animations for mobile */
  .mobile-optimized-animation {
    will-change: transform !important;
    transform: translateZ(0) !important;
  }

  /* === FORM OPTIMIZATIONS === */
  
  /* Better form field spacing */
  .mobile-form-spacing .space-y-4 > * + * {
    margin-top: var(--spacing-4) !important;
  }

  .mobile-form-spacing .space-y-6 > * + * {
    margin-top: var(--spacing-6) !important;
  }

  /* Full width form controls */
  .mobile-form-full input,
  .mobile-form-full select,
  .mobile-form-full textarea,
  .mobile-form-full button {
    width: 100% !important;
  }

  /* === ACCESSIBILITY ENHANCEMENTS === */
  
  /* Enhanced focus indicators for mobile - WCAG AAA */
  .mobile-focus-enhanced:focus,
  .mobile-focus-enhanced:focus-visible {
    outline: 3px solid var(--color-primary-500) !important;
    outline-offset: 3px !important;
    box-shadow: 0 0 0 6px rgba(232, 90, 40, 0.15) !important; /* Extra visual ring */
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .mobile-text-wrap {
      color: black !important;
      background: white !important;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .mobile-optimized-animation {
      animation: none !important;
      transition: none !important;
    }
  }

  /* === TABLE RESPONSIVENESS === */
  
  /* Responsive tables */
  .mobile-table-responsive {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }

  .mobile-table-responsive table {
    min-width: 600px !important;
  }

  /* === DIALOG & MODAL OPTIMIZATIONS === */

  /* Full screen modals on mobile */
  .mobile-modal-full [role="dialog"] {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    max-width: none !important;
    max-height: none !important;
    border-radius: 0 !important;
    margin: 0 !important;
  }

  /* === ENHANCED MOBILE INTERACTIONS === */

  /* Haptic feedback styles for visual indication */
  .haptic-light {
    transition: transform 0.1s ease-out;
  }

  .haptic-light:active {
    transform: scale(0.98);
  }

  .haptic-medium {
    transition: transform 0.15s ease-out, box-shadow 0.15s ease-out;
  }

  .haptic-medium:active {
    transform: scale(0.95);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  .haptic-strong {
    transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
  }

  .haptic-strong:active {
    transform: scale(0.92);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
  }

  /* Enhanced mobile card interactions */
  .mobile-card-interactive {
    transition: all 0.2s ease-out;
    cursor: pointer;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  .mobile-card-interactive:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  }

  .mobile-card-interactive:active {
    transform: translateY(0);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  /* Swipe indicator for swipeable elements */
  .swipe-indicator {
    position: relative;
  }

  .swipe-indicator::after {
    content: '';
    position: absolute;
    top: 50%;
    right: 12px;
    transform: translateY(-50%);
    width: 20px;
    height: 2px;
    background: var(--color-text-secondary, #666);
    border-radius: 1px;
    opacity: 0.3;
  }

  .swipe-indicator::before {
    content: '';
    position: absolute;
    top: 50%;
    right: 16px;
    transform: translateY(-50%);
    width: 12px;
    height: 2px;
    background: var(--color-text-secondary, #666);
    border-radius: 1px;
    opacity: 0.5;
  }

  /* Pull-to-refresh indicator styles */
  .pull-indicator {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 16px;
    opacity: 0;
    transform: translateY(-100%);
    transition: all 0.3s ease-out;
  }

  .pull-indicator.visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Enhanced focus states for mobile - WCAG AAA */
  .mobile-focus-ring:focus-visible {
    outline: 3px solid var(--color-primary-500) !important;
    outline-offset: 3px !important;
    box-shadow: 0 0 0 6px rgba(232, 90, 40, 0.15) !important; /* Consistent with design system */
  }

  /* Mobile-optimized loading states */
  .mobile-loading {
    position: relative;
    pointer-events: none;
    opacity: 0.7;
  }

  .mobile-loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid var(--color-primary-500, #007bff);
    border-top: 2px solid transparent;
    border-radius: 50%;
    animation: mobile-spin 1s linear infinite;
  }

  @keyframes mobile-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Enhanced mobile scroll indicators */
  .mobile-scroll-hint {
    position: relative;
  }

  .mobile-scroll-hint::after {
    content: '⟩';
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--color-text-secondary, #666);
    font-size: 18px;
    opacity: 0.6;
    animation: mobile-scroll-pulse 2s ease-in-out infinite;
  }

  @keyframes mobile-scroll-pulse {
    0%, 100% { opacity: 0.6; transform: translateY(-50%) translateX(0); }
    50% { opacity: 1; transform: translateY(-50%) translateX(3px); }
  }

  /* Mobile-safe sticky elements */
  .mobile-sticky-safe {
    position: -webkit-sticky;
    position: sticky;
    top: env(safe-area-inset-top, 0);
    z-index: 100;
  }

  /* Enhanced mobile list interactions */
  .mobile-list-item {
    padding: 16px !important;
    min-height: 64px !important;
    border-bottom: 1px solid var(--color-border, #e5e5e5);
    transition: background-color 0.15s ease-out;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  .mobile-list-item:active {
    background-color: var(--color-accent-50, #f8f9fa) !important;
  }

  /* Mobile-optimized toggles and switches */
  .mobile-toggle {
    min-width: 56px !important;
    min-height: 32px !important;
    padding: 4px !important;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
}